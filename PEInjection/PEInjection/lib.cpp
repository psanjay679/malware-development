#include "lib.h"

void parse_pe(DWORD64 pe_base) {

}

DWORD64 get_pe_base(char* file_name) {
	
	HANDLE h_file;
	DWORD file_size;
	unsigned char* buffer;

	h_file = CreateFileA(file_name, GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL);
	
	if (h_file == INVALID_HANDLE_VALUE) {
		printf("could not open file. error: %x\n", GetLastError());
		exit(-1);
	}
	
	file_size = GetFileSize(h_file, NULL);

	buffer = (unsigned char*)malloc(file_size * (sizeof(unsigned char)));
	ReadFile(h_file, (VOID*)buffer, file_size, NULL, NULL);

	for (int i = 0; i < 2; i++) {
		printf("%x ", buffer[i]);
	}
	printf("\n");

	return (DWORD64)buffer;
}